# Utilities

Utility functions and helpers used throughout APiGen Studio.

## Notifications

Centralized notification system using Mantine notifications.

### Location

`src/utils/notifications.ts`

### Usage

```typescript
import { notify } from '@/utils/notifications';

// Success notification
notify.success({
  title: 'Entity Created',
  message: 'Product entity was created successfully',
});

// Error notification
notify.error({
  title: 'Generation Failed',
  message: 'Could not connect to the server',
});

// Info notification
notify.info({
  message: 'Project exported to JSON',
});

// Warning notification
notify.warning({
  title: 'Unsaved Changes',
  message: 'You have unsaved changes that will be lost',
});
```

### API

```typescript
interface NotifyOptions {
  title?: string;
  message: string;
  autoClose?: number;  // ms, default varies by type
}

notify.success(options: NotifyOptions): void
notify.error(options: NotifyOptions): void
notify.info(options: NotifyOptions): void
notify.warning(options: NotifyOptions): void
```

---

## SQL Parser

Parses SQL CREATE TABLE statements into entity definitions.

### Location

`src/utils/sqlParser.ts`

### Usage

```typescript
import { parseSQL } from '@/utils/sqlParser';

const sql = `
  CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
`;

const { entities, relations } = parseSQL(sql);
// Returns parsed entities and foreign key relations
```

### Supported Features

- `CREATE TABLE` statements
- Column types: `BIGSERIAL`, `VARCHAR`, `TEXT`, `INTEGER`, `BOOLEAN`, `TIMESTAMP`, etc.
- Constraints: `PRIMARY KEY`, `NOT NULL`, `UNIQUE`, `DEFAULT`
- Foreign keys: `REFERENCES` clause
- Comments: `--` and `/* */` styles

### Type Mapping

| SQL Type | Java Type |
|----------|-----------|
| `BIGSERIAL`, `BIGINT` | `Long` |
| `INTEGER`, `INT` | `Integer` |
| `VARCHAR`, `TEXT` | `String` |
| `BOOLEAN` | `Boolean` |
| `TIMESTAMP` | `LocalDateTime` |
| `DATE` | `LocalDate` |
| `DECIMAL`, `NUMERIC` | `BigDecimal` |
| `UUID` | `UUID` |

---

## SQL Generator

Generates PostgreSQL DDL from entity definitions.

### Location

`src/utils/sqlGenerator.ts`

### Usage

```typescript
import { generateSQL } from '@/utils/sqlGenerator';

const sql = generateSQL(entities, relations, 'MyProject');
// Returns PostgreSQL CREATE TABLE statements
```

### Output Example

```sql
-- Generated by APiGen Studio
-- Project: MyProject

CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE orders (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(id),
    total DECIMAL(19,2) NOT NULL
);
```

---

## Validation

Form validation utilities.

### Location

`src/utils/validation.ts`

### Functions

```typescript
// Entity name validation (PascalCase)
isValidEntityName('Product');     // true
isValidEntityName('product');     // false
isValidEntityName('my_entity');   // false

// Table name validation (snake_case)
isValidTableName('products');     // true
isValidTableName('order_items');  // true
isValidTableName('Products');     // false

// Field name validation (camelCase)
isValidFieldName('firstName');    // true
isValidFieldName('first_name');   // false

// Package name validation
isValidPackageName('com.example.app');  // true
isValidPackageName('com.example');      // true
isValidPackageName('invalid');          // false
```

---

## Archive Security

Validates ZIP archives for security issues.

### Location

`src/utils/archiveSecurity.ts`

### Usage

```typescript
import { validateZipArchive } from '@/utils/archiveSecurity';

const validation = await validateZipArchive(zipBlob);

if (!validation.isValid) {
  console.error('Security issues:', validation.errors);
}
```

### Checks

| Check | Threshold |
|-------|-----------|
| Path traversal | No `../` in paths |
| Single file size | < 10 MB |
| Total archive size | < 50 MB |
| File count | < 1000 files |
| Dangerous extensions | No `.exe`, `.dll`, `.sh` |

---

## Canvas Layout

Auto-layout algorithms for the entity canvas.

### Location

`src/utils/canvasLayout.ts`

### Usage

```typescript
import { calculateAutoLayout } from '@/utils/canvasLayout';

const newPositions = calculateAutoLayout(nodes, edges);
// Returns: Map<string, { x: number, y: number }>
```

### Algorithm

Uses a force-directed layout with:
- Node repulsion
- Edge attraction
- Collision avoidance
- Grid snapping

---

## Canvas Constants

Shared constants for canvas dimensions.

### Location

`src/utils/canvasConstants.ts`

### Constants

```typescript
export const ENTITY_NODE = {
  WIDTH: 220,
  MIN_HEIGHT: 100,
  FIELD_HEIGHT: 28,
  COLLAPSED_FIELD_LIMIT: 5,
};

export const CANVAS = {
  GRID_GAP: 60,
  GRAPH_MARGIN: 50,
  SNAP_GRID: 15,
};

export const ENTITY_GRID = {
  COLUMNS: 4,
  SPACING_X: 320,
  SPACING_Y: 250,
  PADDING: 50,
};

export const CANVAS_VIEWS = {
  ENTITIES: 'entities',
  SERVICES: 'services',
};
```

---

## Type Utilities

Type conversion and naming utilities.

### Location

`src/types/index.ts`

### Functions

```typescript
// Convert to PascalCase
toPascalCase('hello_world');  // 'HelloWorld'
toPascalCase('helloWorld');   // 'HelloWorld'

// Convert to camelCase
toCamelCase('HelloWorld');    // 'helloWorld'
toCamelCase('hello_world');   // 'helloWorld'

// Convert to snake_case
toSnakeCase('HelloWorld');    // 'hello_world'
toSnakeCase('helloWorld');    // 'hello_world'
```

---

## Logger

Development logging utility.

### Location

`src/utils/logger.ts`

### Usage

```typescript
import { logger } from '@/utils/logger';

logger.debug('Debug message', { data });
logger.info('Info message');
logger.warn('Warning message');
logger.error('Error message', error);
```

### Behavior

- **Development**: All logs shown in console
- **Production**: Only warnings and errors logged
- **Testing**: Logs suppressed

---

## Best Practices

### 1. Use Centralized Notifications

```typescript
// ✅ Good
import { notify } from '@/utils/notifications';
notify.success({ message: 'Saved' });

// ❌ Avoid direct Mantine usage
import { notifications } from '@mantine/notifications';
notifications.show({ message: 'Saved' });
```

### 2. Validate User Input

```typescript
import { isValidEntityName } from '@/utils/validation';

if (!isValidEntityName(name)) {
  notify.error({ message: 'Invalid entity name' });
  return;
}
```

### 3. Use Constants

```typescript
import { ENTITY_NODE } from '@/utils/canvasConstants';

const nodeWidth = ENTITY_NODE.WIDTH;  // ✅ Use constant
const nodeWidth = 220;                 // ❌ Magic number
```
